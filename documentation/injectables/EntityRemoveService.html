<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>ndb-core documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">ndb-core documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li>Injectables</li>
  <li >EntityRemoveService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/entity/entity-remove.service.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>A service that can be used to safely remove an entity
which includes:</p>
<ul>
 <li> Displaying a confirmation dialog and asking the user whether or not he
 wants to delete the entity
 <li> Removing the entity in the `EntityMapperService` (if he chose so)
 <li> Opening a snack bar to allow the user to undo the action
</ul>

            </p>



            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#remove" >remove</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(confirmationDialog: <a href="../injectables/ConfirmationDialogService.html" target="_self">ConfirmationDialogService</a>, entityMapper: <a href="../injectables/EntityMapperService.html" target="_self">EntityMapperService</a>, snackBar: MatSnackBar)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="51" class="link-to-prism">src/app/core/entity/entity-remove.service.ts:51</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>confirmationDialog</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/ConfirmationDialogService.html" target="_self" >ConfirmationDialogService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>entityMapper</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/EntityMapperService.html" target="_self" >EntityMapperService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>snackBar</td>
                                                  
                                                        <td>
                                                                    <code>MatSnackBar</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="remove"></a>
                    <span class="name">
                        <span ><b>remove</b></span>
                        <a href="#remove"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>remove(entity: E, textOptions?: <a href="../interfaces/RemoveEntityTextOptions.html" target="_self">RemoveEntityTextOptions</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="83"
                            class="link-to-prism">src/app/core/entity/entity-remove.service.ts:83</a></div>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Type parameters :</b>
                    <ul class="type-parameters">
                        <li>E</li>
                    </ul>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Removes the entity after displaying a confirmation dialog.
The returned observable will emit once or twice, depending on how the
user chose.</p>
<ul>
 <li> When the user chose 'no', the subject will emit once with
 <a href="RemoveResult.CANCELLED">CANCELLED</a>.
 <li> When the user chose 'yes', the subject will emit with the result
 <a href="RemoveResult.REMOVED">REMOVED</a>. If the user doesn't undo, the subject will complete
 once the snack bar has disappeared. If the user chose undo, the subject will
 emit with the result <a href="RemoveResult.UNDONE">UNDONE</a>.
</ul>
<br>
This method takes care of saving the entity as if one were to call the resp. methods
of the `EntityMapperService`. It also restores the entity when the user chose to
undo. All of the aforementioned results will only be called if the actions have already
been taken.
<br>
You do not need to unsubscribe from this method as the observable will be closed on all
possible paths.
You can only specify some of the options, the options that you don't specify will then be
the default ones.
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>entity</td>
                                    <td>
                                            <code>E</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>The entity to remove</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>textOptions</td>
                                    <td>
                                                <code><a href="../interfaces/RemoveEntityTextOptions.html" target="_self" >RemoveEntityTextOptions</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                    <td>
                                        <p>Options that you can specify to override the default options.
You can only specify some of the options, the options that you don&#39;t specify will then be
the default ones.</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../miscellaneous/enumerations.html#RemoveResult" target="_self" >Observable&lt;RemoveResult&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &quot;@angular/core&quot;;
import { ConfirmationDialogService } from &quot;../confirmation-dialog/confirmation-dialog.service&quot;;
import { EntityMapperService } from &quot;./entity-mapper.service&quot;;
import { MatSnackBar } from &quot;@angular/material/snack-bar&quot;;
import { Entity } from &quot;./model/entity&quot;;
import { Observable, race, Subject } from &quot;rxjs&quot;;
import { map } from &quot;rxjs/operators&quot;;

/**
 * All possible results when removing an entity
 */
export enum RemoveResult {
  /**
   * The user cancelled the action
   */
  CANCELLED,
  /**
   * The entity was successfully removed
   */
  REMOVED,
  /**
   * The user has undone the action and the entity
   * now exists again
   */
  UNDONE,
}

/**
 * Additional options that can be (partly) specified
 * for the several titles
 */
export interface RemoveEntityTextOptions {
  dialogTitle?: string;
  dialogText?: string;
  deletedEntityInformation?: string;
}

/**
 * A service that can be used to safely remove an entity
 * which includes:
 * &lt;ul&gt;
 *  &lt;li&gt; Displaying a confirmation dialog and asking the user whether or not he
 *  wants to delete the entity
 *  &lt;li&gt; Removing the entity in the &#x60;EntityMapperService&#x60; (if he chose so)
 *  &lt;li&gt; Opening a snack bar to allow the user to undo the action
 * &lt;/ul&gt;
 */
@Injectable({
  providedIn: &quot;root&quot;,
})
export class EntityRemoveService {
  constructor(
    private confirmationDialog: ConfirmationDialogService,
    private entityMapper: EntityMapperService,
    private snackBar: MatSnackBar
  ) {}

  /**
   * Removes the entity after displaying a confirmation dialog.
   * The returned observable will emit once or twice, depending on how the
   * user chose.
   * &lt;ul&gt;
   *  &lt;li&gt; When the user chose &#x27;no&#x27;, the subject will emit once with
   *  {@link RemoveResult.CANCELLED CANCELLED}.
   *  &lt;li&gt; When the user chose &#x27;yes&#x27;, the subject will emit with the result
   *  {@link RemoveResult.REMOVED REMOVED}. If the user doesn&#x27;t undo, the subject will complete
   *  once the snack bar has disappeared. If the user chose undo, the subject will
   *  emit with the result {@link RemoveResult.UNDONE UNDONE}.
   * &lt;/ul&gt;
   * &lt;br&gt;
   * This method takes care of saving the entity as if one were to call the resp. methods
   * of the &#x60;EntityMapperService&#x60;. It also restores the entity when the user chose to
   * undo. All of the aforementioned results will only be called if the actions have already
   * been taken.
   * &lt;br&gt;
   * You do not need to unsubscribe from this method as the observable will be closed on all
   * possible paths.
   * @param entity The entity to remove
   * @param textOptions Options that you can specify to override the default options.
   * You can only specify some of the options, the options that you don&#x27;t specify will then be
   * the default ones.
   */
  remove&lt;E extends Entity&gt;(
    entity: E,
    textOptions?: RemoveEntityTextOptions
  ): Observable&lt;RemoveResult&gt; {
    const subject &#x3D; new Subject&lt;RemoveResult&gt;();
    const dialogTitle &#x3D;
      textOptions?.dialogTitle || $localize&#x60;:Delete confirmation title:Delete?&#x60;;
    const dialogText &#x3D;
      textOptions?.dialogText ||
      $localize&#x60;:Delete confirmation text:Are you sure you want to delete this ${entity.getType()}?&#x60;;
    this.confirmationDialog
      .getConfirmation(dialogTitle, dialogText)
      .then((confirmed) &#x3D;&gt; {
        if (confirmed) {
          const snackBarTitle &#x3D;
            textOptions?.deletedEntityInformation ||
            $localize&#x60;:Deleted Entity information:Deleted Entity ${entity.toString()}&#x60;;
          this.removeEntityAndOpenSnackBar(entity, snackBarTitle, subject);
        } else {
          subject.next(RemoveResult.CANCELLED);
          subject.complete();
        }
      });
    return subject.asObservable();
  }

  /**
   * Decoupled from the main method for readability
   * @param entity The entity to remove
   * @param snackBarTitle The title of the snack-bar
   * @param resultSender The sender that informs when the user
   * has clicked &#x27;undo&#x27; and that completes once no undo is possible
   * @private
   */
  private async removeEntityAndOpenSnackBar(
    entity: Entity,
    snackBarTitle: string,
    resultSender: Subject&lt;RemoveResult&gt;
  ) {
    await this.entityMapper.remove(entity);
    resultSender.next(RemoveResult.REMOVED);
    const snackBarRef &#x3D; this.snackBar.open(
      snackBarTitle,
      $localize&#x60;:Undo deleting an entity:Undo&#x60;,
      {
        duration: 8000,
      }
    );
    race(
      snackBarRef.onAction().pipe(map(() &#x3D;&gt; true)),
      snackBarRef.afterDismissed().pipe(map(() &#x3D;&gt; false))
    ).subscribe(async (next) &#x3D;&gt; {
      if (next) {
        await this.entityMapper.save(entity, true);
        resultSender.next(RemoveResult.UNDONE);
      }
      resultSender.complete();
    });
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'EntityRemoveService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
